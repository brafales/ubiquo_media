<%
  options = {
    :url => search_ubiquo_assets_path,
    :method => :get,
    :before => "Element.show(\"search_spinner_#{field}\")",
    :success => "Element.hide(\"search_spinner_#{field}\")",
    :failure => "Element.hide(\"search_spinner_#{field}\")",
    :with => "'field=#{field}&asset_type_id=' + $('asset_type_id_#{field}').value + '&text=' + $('asset_search_string_#{field}').value + '&visibility=' + $('asset_visibility').value",
  }      
%>

<h4><%= t('ubiquo.media.search_asset') %>:</h4>
<%= text_field_tag(:string, '', :id => "asset_search_string_#{field}", :onkeypress => 'return (event.keyCode!=13);') %>
<%= observe_field("asset_search_string_#{field}", options.merge(:frequency => 0.5)) %>
<%= hidden_field_tag :asset_visibility, visibility %>
<% if types.size == 1 %>
	<%= hidden_field_tag "asset_type_id_#{field}".to_sym, types.first.id.to_s %>
<% else %>
	<%= label :asset, "asset_type_id_#{field}".to_sym, Asset.human_attribute_name("asset_type_id") %>
	<%= type_selector(field, types) %>
	<%= observe_field("asset_type_id_#{field}", options) %>
<% end %>
  <%= ubiquo_image_tag("ajax-loader.gif", :id => "search_spinner_#{field}", :class=>"spinner" ) %>
  <div id="asset_search_results_<%= field %>"></div>

<script type="text/javascript">
  Event.observe(window, 'load', function() {
    <%= remote_function(options) %>
  });
  <%= remote_function(options) %>
</script>
