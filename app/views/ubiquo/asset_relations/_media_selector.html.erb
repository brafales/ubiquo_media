<%= render :partial => "ubiquo/asset_relations/media_javascript.html.erb" %>
<div id="media_selector_<%= counter %>" class="media_selector">
  <div class="selected-assets">
    <fieldset>
      <div class="list_caption">
      <%= hidden_field_tag "#{object_name}[#{field}_ids][]", nil  %>
      </div>
      <ul class="items-list" id="relations_list_<%= counter %>">
      </ul>
    </fieldset>
  </div>
  <div class="select-assets">
    <fieldset>
      <legend><%= t('ubiquo.media.media_item_new') %></legend>
      <div class="add" id="add_<%= counter%>">
	<%= render :partial => 'ubiquo/asset_relations/asset_form.html.erb', 
	    :locals => { 
              :field => field,
              :counter => counter, 
              :types => assets.options[:asset_types],
              :visibility => visibility } %>
      </div>
    </fieldset>
    <fieldset>
      <legend><%= t('ubiquo.media.select_existing_media_item') %></legend>
      <div class="search-block" id="search_<%= counter%>">
	<%= render :partial => 'ubiquo/asset_relations/asset_search.html.erb', 
	    :locals => { 
              :counter => counter,
              :field => field, 
              :types => assets.options[:asset_types],
              :visibility => visibility } %>
      </div>
      <div id="asset_search_results_<%= counter %>" class="search-results">
      </div>
    </fieldset>
  </div>
</div>
<% javascript_tag do %>
  media_fields.add_field('<%= counter %>', '<%= field %>', <%= assets.options[:size].to_i %>, '<%= object_name %>');

  <% assets.each do |asset| %>
    media_fields.add_element(
      '<%= field %>', 
      <%= asset.id %>, 
      <%= object.name_for_asset(field, asset).to_json %>,
      <%= counter %>, 
      <%= thumbnail_url(asset).to_json %>,
      <%= view_asset_link(asset).to_json %>,
      <%= asset.name.to_json %>,
      <%= {:advanced_form => advanced_asset_form_for(asset)}.to_json %>
    );
  <% end %>

  document.observe("dom:loaded", function() {
    Ubiquo.Forms.createTabs('#media_selector_<%= counter %> .select-assets','legend');
  });
<% end %>
