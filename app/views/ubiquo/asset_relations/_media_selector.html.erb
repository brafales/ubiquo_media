<%= render :partial => "ubiquo/asset_relations/media_javascript.html.erb" %>

<div id="media_selector_<%= counter %>" class="media_selector">
  
  <div class="list_caption">
    <%= hidden_field_tag "#{object_name}[#{field}_ids][]", nil  %>
  </div>
  <ul class="relations_list" id="relations_list_<%= counter %>">
  </ul>
  <div class="actions">
    <fieldset>
      <legend><%= link_to_function( t('ubiquo.media.media_item_new'), 
	            "blind_toggle('add_#{counter}', 'search_#{counter}')") %></legend>

      <div class="add" id="add_<%= counter%>">
	<%= render :partial => 'ubiquo/asset_relations/asset_form.html.erb', 
	    :locals => { 
              :field => field,
              :counter => counter, 
              :types => assets.options[:asset_types],
              :visibility => visibility } %>
      </div>

    </fieldset>
    <fieldset>  
      <legend><%= link_to_function( t('ubiquo.media.select_existing_media_item'), 
	            "blind_toggle('search_#{counter}', 'add_#{counter}')") %></legend>

      <div class="search" id="search_<%= counter%>">
	<%= render :partial => 'ubiquo/asset_relations/asset_search.html.erb', 
	    :locals => { 
              :counter => counter,
              :field => field, 
              :types => assets.options[:asset_types],
              :visibility => visibility } %>
      </div>
    </fieldset>
  </div>
</div>


<script type="text/javascript">
  $('media_selector_<%= counter %>').select('.add').first().hide();
  $('media_selector_<%= counter %>').select('.search').first().hide(); 
  
  media_fields.add_field('<%= counter %>', '<%= field %>', <%= assets.options[:size].to_i %>, '<%= object_name %>');

  <% assets.each do |asset| %>
    media_fields.add_element(
      '<%= field %>', 
      <%= asset.id %>, 
      <%= object.name_for_asset(field, asset).to_json %>,
      <%= counter %>, 
      <%= thumbnail_url(asset).to_json %>,
      <%= view_asset_link(asset).to_json %>
    );
  <% end %>
</script>
