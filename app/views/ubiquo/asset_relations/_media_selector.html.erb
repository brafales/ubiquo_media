<%= render :partial => "ubiquo/asset_relations/media_javascript.html.erb" %>

<div id="<%= field %>_media_selector" class="media_selector">
  
    <div class="list_caption">
      <%= hidden_field_tag "#{object_name}[#{field}_ids][]", nil  %>
    </div>
    <ul id="<%= field %>_relations_list" class="relations_list">
    </ul>
  	<div id="actions_<%= field %>">
	<fieldset>
	  <legend><%= link_to_function( t('ubiquo.media.media_item_new'), 
	                       "blind_toggle('add_#{field}', 'search_#{field}')") %></legend>

	  <div id="add_<%= field %>">
	    <%= render :partial => 'ubiquo/asset_relations/asset_form.html.erb', 
	               :locals => { :field => field, 
                                :types => assets.options[:asset_types],
                                :visibility => visibility } %>
	  </div>

  	</fieldset>
	<fieldset>  
	  <legend><%= link_to_function( t('ubiquo.media.select_existing_media_item'), 
	                       "blind_toggle('search_#{field}', 'add_#{field}')") %></legend>

	  <div id="search_<%= field %>">
	    <%= render :partial => 'ubiquo/asset_relations/asset_search.html.erb', 
	               :locals => { :field => field, 
                                :types => assets.options[:asset_types],
                                :visibility => visibility } %>
	  </div>
	</fieldset>
	</div>
</div>


<script type="text/javascript">
	$('add_<%= field %>').hide();
	$('search_<%= field %>').hide(); 
	media_fields.set_name('<%= object_name %>');
	media_fields.add_field('<%= field %>', <%= assets.options[:size].to_i %>);
   <% assets.each do |asset| %>
		media_fields.add_element(
			'<%= field %>', 
			<%= asset.id %>, 
			<%= object.name_for_asset(field, asset).to_json %>,
            <%= thumbnail_url(asset).to_json %>,
			<%= view_asset_link(asset).to_json %>
		);
	<% end %>
</script>
